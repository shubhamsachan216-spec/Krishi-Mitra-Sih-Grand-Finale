<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agricultural Marketing Information System</title>
  <style>
    /* VARIABLES AND BASE STYLES from original */
    :root{ --bg:#f0f4f0; --card:#ffffff; --muted:#6b7280; --accent:#2f855a; --dark-blue:#0f172a; --agmark-green:#4a6e4d; --agmark-bg:#E8F9EE; }
    *{box-sizing:border-box}
    body{font-family:'Inter',sans-serif;margin:0;background:var(--agmark-bg);color:var(--dark-blue)}
    
    /* NEW STYLES for AgMARKNET Banner */
    .hero-banner {
        background-color: var(--agmark-green); /* Placeholder for banner background */
        background-image: url('placeholder-farmer-image.jpg'); /* Placeholder, replace with actual banner image */
        background-size: cover;
        background-position: center;
        height: 300px;
        display: flex;
        align-items: center;
        padding-left: 10%;
        color: #fff;
        position: relative;
    }
    .hero-content {
        max-width: 400px;
        background: rgba(0, 0, 0, 0.4); /* Dark overlay for text readability */
        padding: 20px;
        border-radius: 8px;
    }
    .hero-logo {
        font-size: 40px;
        font-weight: bold;
        letter-spacing: 2px;
        margin-bottom: 5px;
    }
    .hero-info {
        font-size: 24px;
        margin: 0;
        font-weight: 300;
    }
    
    /* NEW STYLES for Tabs and Filter Bar */
    .tab-container {
        max-width: 1100px;
        margin: -40px auto 0; /* Pull tabs up over the banner */
        background: var(--card);
        border-radius: 8px 8px 0 0;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        padding: 0 20px;
        position: relative;
        z-index: 10;
    }
    .tabs {
        display: flex;
        border-bottom: 2px solid #e0e0e0;
    }
    .tab {
        padding: 15px 25px;
        cursor: pointer;
        font-weight: 500;
        color: var(--muted);
        transition: color 0.3s, border-bottom 0.3s;
    }
    .tab.active {
        color: var(--dark-blue);
        border-bottom: 3px solid var(--accent);
        margin-bottom: -2px;
        font-weight: 600;
    }
    
    .filter-bar {
        background: var(--card);
        padding: 15px 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        border-bottom: 1px solid #e0e0e0;
    }
    .filter-item {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        font-size: 12px;
        color: var(--muted);
    }
    .filter-item select, .filter-item input {
        padding: 6px 8px;
        border-radius: 4px;
        border: 1px solid #d1d5db;
        background: #f9f9f9;
        min-width: 120px;
        margin-top: 2px;
    }
    
    /* STYLES for the Table Container */
    .container{max-width:1100px;margin:20px auto;padding:0 20px}
    h1{margin:0;font-size:20px; display: none; } /* Hide old H1 */
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0; justify-content: flex-end;} /* Move fetch/export to the right */
    select, input, button{padding:8px 10px;border-radius:8px;border:1px solid #d1d5db}
    button{background:var(--accent);color:#fff;border:none;cursor:pointer}
    button.secondary{background:#fff;color:var(--accent);border:1px solid #c7e3d0}
    table{width:100%;border-collapse:collapse;margin-top:12px; background: var(--card); border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05)}
    th,td{padding:12px 10px;border-bottom:1px solid #eef2e7;text-align:left; font-size: 14px;}
    th{background:#f8fff8;position:sticky;top:0;z-index:2; font-weight: 600;}
    .hidden{display:none}
    
    .search-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 15px;
    }
    .search-row .filter-item input {
        min-width: 300px;
    }

    /* FOOTER STYLES */
    .footer-container {
        max-width: 1100px;
        margin: 40px auto 0;
        padding: 40px 20px;
        color: var(--dark-blue);
    }
    .footer-main {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        padding-bottom: 30px;
        border-bottom: 1px solid #e0e0e0;
        gap: 20px;
    }
    .footer-section {
        flex: 1;
        min-width: 150px;
    }
    .footer-brand {
        flex: 2;
        min-width: 250px;
    }
    .footer-logo-text {
        font-size: 20px;
        font-weight: 600;
        color: var(--agmark-green); /* Using the green color for the logo */
        margin-bottom: 10px;
        display: flex;
        align-items: center;
    }
    /* Placeholder for the logo icon (if needed, currently text only) */
    .footer-logo-text:before {
        content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234a6e4d' width='24px' height='24px'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.5 16.5v-9L16 12l-6.5 4.5z'/%3E%3C/svg%3E");
        margin-right: 8px;
        /* I'm using a placeholder SVG path (a simple leaf/growth icon) to represent the logo image */
    }
    .footer-description {
        font-size: 14px;
        color: var(--muted);
        line-height: 1.6;
    }
    .footer-section h4 {
        font-size: 16px;
        margin-top: 0;
        margin-bottom: 15px;
        font-weight: 600;
    }
    .footer-links a {
        display: block;
        color: var(--muted);
        text-decoration: none;
        margin-bottom: 8px;
        font-size: 14px;
        transition: color 0.2s;
    }
    .footer-links a:hover {
        color: var(--accent);
    }
    .social-icons a {
        color: var(--agmark-green);
        font-size: 24px;
        margin-right: 15px;
        text-decoration: none;
    }
    /* Fallback for social icons - usually Font Awesome/SVGs are used. Using placeholders */
    .social-icons .icon-fb:before { content: 'f'; font-family: sans-serif; }
    .social-icons .icon-tw:before { content: 't'; font-family: sans-serif; }
    .social-icons .icon-ig:before { content: 'i'; font-family: sans-serif; }

    /* The simplest way to represent the social icons without a library is using text/emoji placeholders. 
       For better representation, I'll use simple text in the HTML and rely on styles/images for actual deployment. 
       Since I cannot inject images or full icon libraries, I will use placeholder text/emoji for the icons.
    */
    .social-icons a {
        color: var(--agmark-green);
        font-size: 20px;
        margin-right: 15px;
        text-decoration: none;
    }
    
    .footer-copyright {
        padding-top: 20px;
        font-size: 12px;
        color: var(--muted);
    }
  </style>
</head>
<body>
  
  <div class="hero-banner" style="background-image: url('https://as1.ftcdn.net/v2/jpg/08/62/70/18/1000_F_862701842_3wQgWJxXBcP3mbBp0Z6EnZnSsJXjXbnY.jpg');">
      <div class="hero-content">
          <div class="hero-logo">Krishi Mitra</div>
          <p class="hero-info">Live Market Prices</p>
      </div>
  </div>

  <div class="tab-container">
      <div class="tabs">
          <div class="tab active">Market Wise Price & Arrival</div>
          <div class="tab">Crop Season Wise Price & Arrival</div>
      </div>
      <div class="filter-bar">
          <div class="filter-item">
              <label>State</label>
              <select><option>Kerala</option></select>
          </div>
          <div class="filter-item">
              <label>District</label>
              <select><option>All Districts</option></select>
          </div>
          <div class="filter-item">
              <label>Market</label>
              <select><option>All Markets</option></select>
          </div>
          <div class="filter-item">
              <label>Commodity Group</label>
              <select><option>All Comm. Group</option></select>
          </div>
          <div class="filter-item">
              <label>Commodity</label>
              <select id="commodityFilter" title="Commodity"><option value="">All Commodities</option></select>
          </div>
          <div class="filter-item">
              <label>Variety</label>
              <select><option>All Varieties</option></select>
          </div>
          <div class="filter-item">
              <label>Guide</label>
              <select><option>FAQ</option></select>
          </div>
      </div>
  </div>

  <div class="container">
      
      <div class="search-row">
          <div class="filter-item">
              <label>Search Price Data</label>
              <input id="search" type="text" placeholder="Search commodity / market / variety..." />
          </div>
          <div class="controls">
              <button id="fetchBtn">Fetch Latest</button>
              <button id="exportBtn" class="secondary">Export CSV</button>
          </div>
      </div>
      
      <table id="dataTable">
        <thead>
          <tr>
            <th class="hidden">Arrival Date</th>
            <th>Commodity</th>
            <th>Variety</th>
            <th>Market</th>
            <th>District</th>
            <th>Min Price</th>
            <th>Max Price</th>
            <th>Modal Price</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
  </div>
  
  <footer class="footer-container">
    <div class="footer-main">
        
        <div class="footer-section footer-brand">
            <div class="footer-logo-text">üå± KRISHI MITRA</div>
            <p class="footer-description">
                Krishi-Mitra is a revolutionary agriculture platform where you can find all solutions in one place.
            </p>
        </div>

        <div class="footer-section">
            <h4>Support</h4>
            <div class="footer-links">
                <a href="#">About Us</a>
                <a href="#">Contact Us</a>
            </div>
        </div>

        <div class="footer-section">
            <h4>Useful Links</h4>
            <div class="footer-links">
                <a href="#">Government Schemes</a>
                <a href="#">Farm Blog</a>
            </div>
        </div>

        <div class="footer-section">
            <h4>Follow Us</h4>
            <div class="social-icons">
                <a href="#" aria-label="Facebook">üìò</a>
                <a href="#" aria-label="Twitter">üê¶</a>
                <a href="#" aria-label="Instagram">üì∏</a>
            </div>
        </div>

    </div>
    
    <div class="footer-copyright">
        &copy; 2025 Krishi Mitra. All rights reserved.
    </div>
  </footer>
  <script>
    // --- JAVASCRIPT LOGIC (Mostly Unchanged) ---
    const RESOURCE_ID = '9ef84268-d588-465a-a308-a864a43d0070';
    const API_KEY = '579b464db66ec23bdd000001e5031959e3e442eb6a5d6a51e880bb6e';
    
    // Note: The Commodity filter in the tab section is the one used by the script. 
    // The other filters are placeholders for the UI.
    const commodityFilter = document.getElementById('commodityFilter'); 
    const searchEl = document.getElementById('search');
    const fetchBtn = document.getElementById('fetchBtn');
    const tbody = document.getElementById('tbody');

    let records = [];

    function renderTable(showRecords){
      tbody.innerHTML = '';
      showRecords.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td class="hidden">${r.arrival_date}</td><td>${r.commodity}</td><td>${r.variety}</td><td>${r.market}</td><td>${r.district}</td><td>${r.min_price}</td><td>${r.max_price}</td><td>${r.modal_price}</td>`;
        tbody.appendChild(tr);
      });
    }

    function applyFilters(){
      const q = (searchEl.value||'').toLowerCase();
      const comFilter = (commodityFilter.value||'').toLowerCase();
      let filtered = records.filter(r=>{
        // Check if the actual data is from Kerala (since API filters by KERALA state)
        // If you were to implement all filters, you'd check the other dropdowns here too.
        if(comFilter && r.commodity.toLowerCase()!==comFilter) return false;
        if(q && !((r.commodity+' '+r.variety+' '+r.market).toLowerCase().includes(q))) return false;
        return true;
      });
      renderTable(filtered);
    }

    async function fetchLatest(){
      const url=`https://api.data.gov.in/resource/${RESOURCE_ID}?api-key=${API_KEY}&format=json&filters[state]=KERALA&sort=arrival_date desc&limit=500`;
      try{
        const res = await fetch(url);
        const json = await res.json();
        let recs = json.records || [];
        // Filter to only the latest date's records
        const latestDate = recs.length ? recs[0].arrival_date : '';
        records = recs.filter(r=>r.arrival_date===latestDate).map(r=>({
          arrival_date:r.arrival_date||'', commodity:r.commodity||'', variety:r.variety||'', market:r.market||r.market_name||'', district:r.district||'', min_price:r.min_price||'', max_price:r.max_price||'', modal_price:r.modal_price||''
        }));

        // Populate the commodity filter dropdown
        const uniqueCom = [...new Set(records.map(r=>r.commodity).filter(c=>c))].sort();
        // The script targets the 'commodityFilter' in the new filter bar
        commodityFilter.innerHTML='<option value="">All Commodities</option>'+uniqueCom.map(c=>`<option value="${c}">${c}</option>`).join('');

        renderTable(records);
      }catch(err){ 
          console.error(err); 
          alert('Failed to fetch latest data: Check console for details.'); 
      }
    }

    fetchBtn.addEventListener('click', fetchLatest);
    searchEl.addEventListener('input', applyFilters);
    commodityFilter.addEventListener('change', applyFilters);

    fetchLatest();
  </script>
</body>
</html>